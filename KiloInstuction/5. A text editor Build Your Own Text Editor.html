<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>5. A text editor | Build Your Own Text Editor</title>
    <link href="5.%20A%20text%20editor%20Build%20Your%20Own%20Text%20Editor_files/style.css" rel="stylesheet">
  <style id="zoomLevel-styles"></style></head>
  <body style="font-size: 16px !important;" data-new-gr-c-s-check-loaded="8.906.0" data-gr-ext-installed="" data-new-gr-c-s-loaded="8.906.0">
    <header class="bar" style="font-size: 16px !important;">
      <nav style="font-size: 16px !important;">
        <a href="https://viewsourcecode.org/snaptoken/kilo/04.aTextViewer.html" style="font-size: 16px !important;">← prev</a>
        <a href="https://viewsourcecode.org/snaptoken/kilo/index.html" style="font-size: 16px !important;">contents</a>
        <a href="https://viewsourcecode.org/snaptoken/kilo/06.search.html" style="font-size: 16px !important;">next →</a>
      </nav>
    </header>
    <div id="container" style="font-size: 16px !important;">
      <h1 id="a-text-editor" style="font-size: 32px !important;">A text editor</h1>
<h2 id="insert-ordinary-characters" style="font-size: 24px !important;"><a href="#insert-ordinary-characters" style="font-size: 24px !important;">Insert ordinary characters</a></h2>

<p style="font-size: 16px !important;">Let’s begin by writing a function that inserts a single character into an
<code style="font-size: 12px !important;">erow</code>, at a given position.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/row-insert-char/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 101</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/row-insert-char" style="font-size: 16px !important;">row-insert-char</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">int</span> <span class="nf" style="font-size: 12px !important;">editorRowCxToRx</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">cx</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorUpdateRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorAppendRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">s</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorRowInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="mi" style="font-size: 12px !important;">0</span> <span class="o" style="font-size: 12px !important;">||</span> <span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">realloc</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">2</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">memmove</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">],</span> <span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">],</span> <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">editorUpdateRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c1" style="font-size: 16px !important;">♎︎ compiles, but with no observable effects</div>
</div>
</div>


<p style="font-size: 16px !important;"><code style="font-size: 12px !important;">memmove()</code> comes from <code style="font-size: 12px !important;">&lt;string.h&gt;</code>. It is like <code style="font-size: 12px !important;">memcpy()</code>, but is safe to use
when the source and destination arrays overlap.</p>

<p style="font-size: 16px !important;">First we validate <code style="font-size: 12px !important;">at</code>, which is the index we want to insert the character
into. Notice that <code style="font-size: 12px !important;">at</code> is allowed to go one character past the end of the
string, in which case the character should be inserted at the end of the
string.</p>

<p style="font-size: 16px !important;">Then we allocate one more byte for the <code style="font-size: 12px !important;">chars</code> of the <code style="font-size: 12px !important;">erow</code> (we add <code style="font-size: 12px !important;">2</code>
because we also have to make room for the null byte), and use <code style="font-size: 12px !important;">memmove()</code> to
make room for the new character. We increment the <code style="font-size: 12px !important;">size</code> of the <code style="font-size: 12px !important;">chars</code> array,
and then actually assign the character to its position in the array. Finally,
we call <code style="font-size: 12px !important;">editorUpdateRow()</code> so that the <code style="font-size: 12px !important;">render</code> and <code style="font-size: 12px !important;">rsize</code> fields get updated
with the new row content.</p>

<p style="font-size: 16px !important;">Now we’ll create a new section called <code style="font-size: 12px !important;">/*** editor operations ***/</code>. This
section will contain functions that we’ll call from <code style="font-size: 12px !important;">editorProcessKeypress()</code>
when we’re mapping keypresses to various text editing operations. We’ll add a
function to this section called <code style="font-size: 12px !important;">editorInsertChar()</code> which will take a
character and use <code style="font-size: 12px !important;">editorRowInsertChar()</code> to insert that character into the
position that the cursor is at.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/editor-insert-char/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 102</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/editor-insert-char" style="font-size: 16px !important;">editor-insert-char</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">int</span> <span class="nf" style="font-size: 12px !important;">editorRowCxToRx</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">cx</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorUpdateRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorAppendRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">s</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorRowInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></ins><ins class="line" style="font-size: 12px !important;"></ins><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorAppendRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">""</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">editorRowInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">],</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c1" style="font-size: 16px !important;">♎︎ compiles, but with no observable effects</div>
</div>
</div>


<p style="font-size: 16px !important;">If <code style="font-size: 12px !important;">E.cy == E.numrows</code>, then the cursor is on the tilde line after the end of
the file, so we need to append a new row to the file before inserting a
character there. After inserting a character, we move the cursor forward so
that the next character the user inserts will go after the character just
inserted.</p>

<p style="font-size: 16px !important;">Notice that <code style="font-size: 12px !important;">editorInsertChar()</code> doesn’t have to worry about the details of
modifying an <code style="font-size: 12px !important;">erow</code>, and <code style="font-size: 12px !important;">editorRowInsertChar()</code> doesn’t have to worry about
where the cursor is. That is the difference between functions in the
<code style="font-size: 12px !important;">/*** editor operations ***/</code> section and functions in the
<code style="font-size: 12px !important;">/*** row operations ***/</code> section.</p>

<p style="font-size: 16px !important;">Let’s call <code style="font-size: 12px !important;">editorInsertChar()</code> in the <code style="font-size: 12px !important;">default:</code> case of the <code style="font-size: 12px !important;">switch</code>
statement in <code style="font-size: 12px !important;">editorProcessKeypress()</code>. This will allow any keypress that isn’t
mapped to another editor function to be inserted directly into the text being
edited.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/key-insert-char/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 103</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/key-insert-char" style="font-size: 16px !important;">key-insert-char</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">key</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorProcessKeypress</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorReadKey</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">switch</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'q'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">STDOUT_FILENO</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\x1b</span><span class="s" style="font-size: 12px !important;">[2J"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">4</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">STDOUT_FILENO</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\x1b</span><span class="s" style="font-size: 12px !important;">[H"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">3</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">exit</span><span class="p" style="font-size: 12px !important;">(</span><span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">HOME_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">END_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">PAGE_DOWN</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">rowoff</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_DOWN</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">rowoff</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screenrows</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">          <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">        <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">times</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screenrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">times</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">)</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span> <span class="o" style="font-size: 12px !important;">?</span> <span class="n" style="font-size: 12px !important;">ARROW_UP</span> <span class="o" style="font-size: 12px !important;">:</span> <span class="n" style="font-size: 12px !important;">ARROW_DOWN</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_UP</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_DOWN</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_LEFT</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_RIGHT</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;">    <span class="nl" style="font-size: 12px !important;">default:</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>


<p style="font-size: 16px !important;">We’ve now officially upgraded our text viewer to a text editor.</p>
<h2 id="prevent-inserting-special-characters" style="font-size: 24px !important;"><a href="#prevent-inserting-special-characters" style="font-size: 24px !important;">Prevent inserting special characters</a></h2>

<p style="font-size: 16px !important;">Currently, if you press keys like <kbd style="font-size: 12px !important;">Backspace</kbd> or <kbd style="font-size: 12px !important;">Enter</kbd>,
those characters will be inserted directly into the text, which we certainly
don’t want. Let’s handle a bunch of these special keys in
<code style="font-size: 12px !important;">editorProcessKeypress()</code>, so that they don’t fall through to the <code style="font-size: 12px !important;">default</code>
case of calling <code style="font-size: 12px !important;">editorInsertChar()</code>.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/block-special-chars/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 104</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/block-special-chars" style="font-size: 16px !important;">block-special-chars</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#define KILO_VERSION "0.0.1"</span></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#define KILO_TAB_STOP 8</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#define CTRL_KEY(k) ((k) &amp; 0x1f)</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="k" style="font-size: 12px !important;">enum</span> <span class="n" style="font-size: 12px !important;">editorKey</span> <span class="p" style="font-size: 12px !important;">{</span></div><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">BACKSPACE</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">127</span><span class="p" style="font-size: 12px !important;">,</span></ins><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">ARROW_LEFT</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">1000</span><span class="p" style="font-size: 12px !important;">,</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">ARROW_RIGHT</span><span class="p" style="font-size: 12px !important;">,</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">ARROW_UP</span><span class="p" style="font-size: 12px !important;">,</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">ARROW_DOWN</span><span class="p" style="font-size: 12px !important;">,</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">DEL_KEY</span><span class="p" style="font-size: 12px !important;">,</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">HOME_KEY</span><span class="p" style="font-size: 12px !important;">,</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">END_KEY</span><span class="p" style="font-size: 12px !important;">,</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">PAGE_UP</span><span class="p" style="font-size: 12px !important;">,</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">PAGE_DOWN</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">};</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">key</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorProcessKeypress</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorReadKey</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">switch</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><ins class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="sc" style="font-size: 12px !important;">'\r'</span><span class="p" style="font-size: 12px !important;">:</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="cm" style="font-size: 12px !important;">/* TODO */</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'q'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">STDOUT_FILENO</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\x1b</span><span class="s" style="font-size: 12px !important;">[2J"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">4</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">STDOUT_FILENO</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\x1b</span><span class="s" style="font-size: 12px !important;">[H"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">3</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">exit</span><span class="p" style="font-size: 12px !important;">(</span><span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">HOME_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">END_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">BACKSPACE</span><span class="p" style="font-size: 12px !important;">:</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'h'</span><span class="p" style="font-size: 12px !important;">):</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">DEL_KEY</span><span class="p" style="font-size: 12px !important;">:</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="cm" style="font-size: 12px !important;">/* TODO */</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">PAGE_DOWN</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">rowoff</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_DOWN</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">rowoff</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screenrows</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">          <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">        <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">times</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screenrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">times</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">)</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span> <span class="o" style="font-size: 12px !important;">?</span> <span class="n" style="font-size: 12px !important;">ARROW_UP</span> <span class="o" style="font-size: 12px !important;">:</span> <span class="n" style="font-size: 12px !important;">ARROW_DOWN</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_UP</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_DOWN</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_LEFT</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_RIGHT</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'l'</span><span class="p" style="font-size: 12px !important;">):</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="sc" style="font-size: 12px !important;">'\x1b'</span><span class="p" style="font-size: 12px !important;">:</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="nl" style="font-size: 12px !important;">default:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>


<p style="font-size: 16px !important;"><kbd style="font-size: 12px !important;">Backspace</kbd> doesn’t have a human-readable backslash-escape
representation in C (like <code style="font-size: 12px !important;">\n</code>, <code style="font-size: 12px !important;">\r</code>, and so on), so we make it part of the
<code style="font-size: 12px !important;">editorKey</code> enum and assign it its ASCII value of <code style="font-size: 12px !important;">127</code>.</p>

<p style="font-size: 16px !important;">In <code style="font-size: 12px !important;">editorProcessKeypress()</code>, the first new key we add to the <code style="font-size: 12px !important;">switch</code>
statement is <code style="font-size: 12px !important;">'\r'</code>, which is the <kbd style="font-size: 12px !important;">Enter</kbd> key. For now we want to
ignore it, but obviously we’ll be making it do something later, so we mark it
with a <code style="font-size: 12px !important;">TODO</code> comment.</p>

<p style="font-size: 16px !important;">We handle <kbd style="font-size: 12px !important;">Backspace</kbd> and <kbd style="font-size: 12px !important;">Delete</kbd> in a similar way, marking
them with a <code style="font-size: 12px !important;">TODO</code>. We also handle the <kbd style="font-size: 12px !important;">Ctrl-H</kbd> key combination, which
sends the control code <code style="font-size: 12px !important;">8</code>, which is originally what the <kbd style="font-size: 12px !important;">Backspace</kbd>
character would send back in the day. If you look at the
<a href="http://www.asciitable.com/" style="font-size: 16px !important;">ASCII table</a>, you’ll see that ASCII code <code style="font-size: 12px !important;">8</code> is
named <code style="font-size: 12px !important;">BS</code> for “backspace”, and ASCII code <code style="font-size: 12px !important;">127</code> is named <code style="font-size: 12px !important;">DEL</code> for “delete”.
But for whatever reason, in modern computers the <kbd style="font-size: 12px !important;">Backspace</kbd> key is
mapped to <code style="font-size: 12px !important;">127</code> and the <kbd style="font-size: 12px !important;">Delete</kbd> key is mapped to the escape sequence
<code style="font-size: 12px !important;">&lt;esc&gt;[3~</code>, as we saw at the end of
<a href="https://viewsourcecode.org/snaptoken/kilo/03.rawInputAndOutput.html#the-delete-key" style="font-size: 16px !important;">chapter 3</a>.</p>

<p style="font-size: 16px !important;">Lastly, we handle <kbd style="font-size: 12px !important;">Ctrl-L</kbd> and <kbd style="font-size: 12px !important;">Escape</kbd> by not doing anything
when those keys are pressed. <kbd style="font-size: 12px !important;">Ctrl-L</kbd> is traditionally used to refresh
the screen in terminal programs. In our text editor, the screen refreshes after
<em style="font-size: 16px !important;">any</em> keypress, so we don’t have to do anything else to implement that feature.
We ignore the <kbd style="font-size: 12px !important;">Escape</kbd> key because there are many key escape sequences
that we aren’t handling (such as the <kbd style="font-size: 12px !important;">F1</kbd>–<kbd style="font-size: 12px !important;">F12</kbd> keys),
and the way we wrote <code style="font-size: 12px !important;">editorReadKey()</code>, pressing those keys will be equivalent
to pressing the <kbd style="font-size: 12px !important;">Escape</kbd> key. We don’t want the user to unwittingly
insert the escape character <code style="font-size: 12px !important;">27</code> into their text, so we ignore those
keypresses.</p>
<h2 id="save-to-disk" style="font-size: 24px !important;"><a href="#save-to-disk" style="font-size: 24px !important;">Save to disk</a></h2>

<p style="font-size: 16px !important;">Now that we’ve finally made text editable, let’s implement saving to disk.
First we’ll write a function that converts our array of <code style="font-size: 12px !important;">erow</code> structs into a
single string that is ready to be written out to a file.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/rows-to-string/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 105</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/rows-to-string" style="font-size: 16px !important;">rows-to-string</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="nf" style="font-size: 12px !important;">editorRowsToString</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">totlen</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">j</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">for</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">j</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span> <span class="n" style="font-size: 12px !important;">j</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">;</span> <span class="n" style="font-size: 12px !important;">j</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">)</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">totlen</span> <span class="o" style="font-size: 12px !important;">+=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">j</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">size</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buflen</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">totlen</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;"></ins><ins class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buf</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">malloc</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">totlen</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">p</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">for</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">j</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span> <span class="n" style="font-size: 12px !important;">j</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">;</span> <span class="n" style="font-size: 12px !important;">j</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">memcpy</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">p</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">j</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">j</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">p</span> <span class="o" style="font-size: 12px !important;">+=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">j</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">p</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="sc" style="font-size: 12px !important;">'\n'</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">p</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></ins><ins class="line" style="font-size: 12px !important;"></ins><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">return</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorOpen</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c1" style="font-size: 16px !important;">♎︎ compiles, but with no observable effects</div>
</div>
</div>


<p style="font-size: 16px !important;">First we add up the lengths of each row of text, adding <code style="font-size: 12px !important;">1</code> to each one for the
newline character we’ll add to the end of each line. We save the total length
into <code style="font-size: 12px !important;">buflen</code>, to tell the caller how long the string is.</p>

<p style="font-size: 16px !important;">Then, after allocating the required memory, we loop through the rows, and
<code style="font-size: 12px !important;">memcpy()</code> the contents of each row to the end of the buffer, appending a
newline character after each row.</p>

<p style="font-size: 16px !important;">We return <code style="font-size: 12px !important;">buf</code>, expecting the caller to <code style="font-size: 12px !important;">free()</code> the memory.</p>

<p style="font-size: 16px !important;">Now we’ll implement the <code style="font-size: 12px !important;">editorSave()</code> function, which will actually write the
string returned by <code style="font-size: 12px !important;">editorRowsToString()</code> to disk.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/save/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 106</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/save" style="font-size: 16px !important;">save</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#define _DEFAULT_SOURCE</span></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#define _BSD_SOURCE</span></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#define _GNU_SOURCE</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#include &lt;ctype.h&gt;</span></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#include &lt;errno.h&gt;</span></div><ins class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#include &lt;fcntl.h&gt;</span></ins><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#include &lt;stdio.h&gt;</span></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#include &lt;stdarg.h&gt;</span></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#include &lt;stdlib.h&gt;</span></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#include &lt;string.h&gt;</span></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#include &lt;sys/ioctl.h&gt;</span></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#include &lt;sys/types.h&gt;</span></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#include &lt;termios.h&gt;</span></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#include &lt;time.h&gt;</span></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#include &lt;unistd.h&gt;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="nf" style="font-size: 12px !important;">editorRowsToString</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorOpen</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorSave</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">)</span> <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;"></ins><ins class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buf</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorRowsToString</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;"></ins><ins class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">fd</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">open</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">O_RDWR</span> <span class="o" style="font-size: 12px !important;">|</span> <span class="n" style="font-size: 12px !important;">O_CREAT</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mo" style="font-size: 12px !important;">0644</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">ftruncate</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">close</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c1" style="font-size: 16px !important;">♎︎ compiles, but with no observable effects</div>
</div>
</div>


<p style="font-size: 16px !important;"><code style="font-size: 12px !important;">open()</code>, <code style="font-size: 12px !important;">O_RDWR</code>, and <code style="font-size: 12px !important;">O_CREAT</code> come from <code style="font-size: 12px !important;">&lt;fcntl.h&gt;</code>. <code style="font-size: 12px !important;">ftruncate()</code> and
<code style="font-size: 12px !important;">close()</code> come from <code style="font-size: 12px !important;">&lt;unistd.h&gt;</code>.</p>

<p style="font-size: 16px !important;">If it’s a new file, then <code style="font-size: 12px !important;">E.filename</code> will be <code style="font-size: 12px !important;">NULL</code>, and we won’t know where
to save the file, so we just <code style="font-size: 12px !important;">return</code> without doing anything for now. Later,
we’ll figure out how to prompt the user for a filename.</p>

<p style="font-size: 16px !important;">Otherwise, we call <code style="font-size: 12px !important;">editorRowsToString()</code>, and <code style="font-size: 12px !important;">write()</code> the string to the path
in <code style="font-size: 12px !important;">E.filename</code>. We tell <code style="font-size: 12px !important;">open()</code> we want to create a new file if it
doesn’t already exist (<code style="font-size: 12px !important;">O_CREAT</code>), and we want to open it for reading and
writing (<code style="font-size: 12px !important;">O_RDWR</code>). Because we used the <code style="font-size: 12px !important;">O_CREAT</code> flag, we have to pass an
extra argument containing the mode (the permissions) the new file should have.
<code style="font-size: 12px !important;">0644</code> is the standard permissions you usually want for text files. It gives
the owner of the file permission to read and write the file, and everyone else
only gets permission to read the file.</p>

<p style="font-size: 16px !important;"><code style="font-size: 12px !important;">ftruncate()</code> sets the file’s size to the specified length. If the file is
larger than that, it will cut off any data at the end of the file to make it
that length. If the file is shorter, it will add <code style="font-size: 12px !important;">0</code> bytes at the end to make
it that length.</p>

<p style="font-size: 16px !important;">The normal way to overwrite a file is to pass the <code style="font-size: 12px !important;">O_TRUNC</code> flag to <code style="font-size: 12px !important;">open()</code>,
which truncates the file completely, making it an empty file, before writing
the new data into it. By truncating the file ourselves to the same length as
the data we are planning to write into it, we are making the whole overwriting
operation a little bit safer in case the <code style="font-size: 12px !important;">ftruncate()</code> call succeeds but the
<code style="font-size: 12px !important;">write()</code> call fails. In that case, the file would still contain most of the
data it had before. But if the file was truncated completely by the <code style="font-size: 12px !important;">open()</code>
call and then the <code style="font-size: 12px !important;">write()</code> failed, you’d end up with all of your data lost.</p>

<p style="font-size: 16px !important;">More advanced editors will write to a new, temporary file, and then rename that
file to the actual file the user wants to overwrite, and they’ll carefully
check for errors through the whole process.</p>

<p style="font-size: 16px !important;">Anyways, all we have to do now is map a key to <code style="font-size: 12px !important;">editorSave()</code>, so let’s do it!
We’ll use <kbd style="font-size: 12px !important;">Ctrl-S</kbd>.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/ctrl-s/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 107</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/ctrl-s" style="font-size: 16px !important;">ctrl-s</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">key</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorProcessKeypress</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorReadKey</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">switch</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="sc" style="font-size: 12px !important;">'\r'</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="cm" style="font-size: 12px !important;">/* TODO */</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'q'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">STDOUT_FILENO</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\x1b</span><span class="s" style="font-size: 12px !important;">[2J"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">4</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">STDOUT_FILENO</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\x1b</span><span class="s" style="font-size: 12px !important;">[H"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">3</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">exit</span><span class="p" style="font-size: 12px !important;">(</span><span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'s'</span><span class="p" style="font-size: 12px !important;">):</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorSave</span><span class="p" style="font-size: 12px !important;">();</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">HOME_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">END_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">BACKSPACE</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'h'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">DEL_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="cm" style="font-size: 12px !important;">/* TODO */</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">PAGE_DOWN</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">rowoff</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_DOWN</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">rowoff</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screenrows</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">          <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">        <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">times</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screenrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">times</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">)</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span> <span class="o" style="font-size: 12px !important;">?</span> <span class="n" style="font-size: 12px !important;">ARROW_UP</span> <span class="o" style="font-size: 12px !important;">:</span> <span class="n" style="font-size: 12px !important;">ARROW_DOWN</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_UP</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_DOWN</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_LEFT</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_RIGHT</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'l'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="sc" style="font-size: 12px !important;">'\x1b'</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="nl" style="font-size: 12px !important;">default:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>


<p style="font-size: 16px !important;">You should be able to open a file in the editor, insert some characters, press
<kbd style="font-size: 12px !important;">Ctrl-S</kbd>, and reopen the file to confirm that the changes you made
were saved.</p>

<p style="font-size: 16px !important;">Let’s add error handling to <code style="font-size: 12px !important;">editorSave()</code>.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/save-errors/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 108</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/save-errors" style="font-size: 16px !important;">save-errors</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="nf" style="font-size: 12px !important;">editorRowsToString</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorOpen</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorSave</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">)</span> <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buf</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorRowsToString</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">fd</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">open</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">O_RDWR</span> <span class="o" style="font-size: 12px !important;">|</span> <span class="n" style="font-size: 12px !important;">O_CREAT</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mo" style="font-size: 12px !important;">0644</span><span class="p" style="font-size: 12px !important;">);</span></div><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="o" style="font-size: 12px !important;">-</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">ftruncate</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="o" style="font-size: 12px !important;">-</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">close</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></div><ins class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">close</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></ins><ins class="line" style="font-size: 12px !important;"></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></ins><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>


<p style="font-size: 16px !important;"><code style="font-size: 12px !important;">open()</code> and <code style="font-size: 12px !important;">ftruncate()</code> both return <code style="font-size: 12px !important;">-1</code> on error. We expect <code style="font-size: 12px !important;">write()</code> to
return the number of bytes we told it to write. Whether or not an error
occurred, we ensure that the file is closed and the memory that <code style="font-size: 12px !important;">buf</code> points to
is freed.</p>

<p style="font-size: 16px !important;">Let’s use <code style="font-size: 12px !important;">editorSetStatusMessage()</code> to notify the user whether the save
succeeded or not. While we’re at it, we’ll add the <kbd style="font-size: 12px !important;">Ctrl-S</kbd> key
binding to the help message that’s set in <code style="font-size: 12px !important;">main()</code>.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/save-status-message/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 109</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/save-status-message" style="font-size: 16px !important;">save-status-message</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="nf" style="font-size: 12px !important;">editorRowsToString</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorOpen</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorSave</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">)</span> <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buf</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorRowsToString</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">fd</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">open</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">O_RDWR</span> <span class="o" style="font-size: 12px !important;">|</span> <span class="n" style="font-size: 12px !important;">O_CREAT</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mo" style="font-size: 12px !important;">0644</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="o" style="font-size: 12px !important;">-</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">ftruncate</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="o" style="font-size: 12px !important;">-</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">close</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></div><ins class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"%d bytes written to disk"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></ins><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">close</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></div><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"Can't save! I/O error: %s"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">strerror</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">errno</span><span class="p" style="font-size: 12px !important;">));</span></ins><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">initEditor</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">int</span> <span class="nf" style="font-size: 12px !important;">main</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">argc</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">argv</span><span class="p" style="font-size: 12px !important;">[])</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">enableRawMode</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">initEditor</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">argc</span> <span class="o" style="font-size: 12px !important;">&gt;=</span> <span class="mi" style="font-size: 12px !important;">2</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorOpen</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">argv</span><span class="p" style="font-size: 12px !important;">[</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">]);</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"HELP: Ctrl-S = save | Ctrl-Q = quit"</span><span class="p" style="font-size: 12px !important;">);</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">(</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorRefreshScreen</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorProcessKeypress</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">return</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c0" style="font-size: 16px !important;">♏︎ doesn’t compile</div>
</div>
</div>


<p style="font-size: 16px !important;"><code style="font-size: 12px !important;">strerror()</code> comes from <code style="font-size: 12px !important;">&lt;string.h&gt;</code>.</p>

<p style="font-size: 16px !important;"><code style="font-size: 12px !important;">strerror()</code> is like <code style="font-size: 12px !important;">perror()</code> (which we use in <code style="font-size: 12px !important;">die()</code>), but it takes the
<code style="font-size: 12px !important;">errno</code> value as an argument and returns the human-readable string for that
error code, so that we can make the error a part of the status message we
display to the user.</p>

<p style="font-size: 16px !important;">The above code doesn’t actually compile, because we are trying to call
<code style="font-size: 12px !important;">editorSetStatusMessage()</code> before it is defined in the file. You can’t do that
in C, because C was made to be a language that can be compiled in a <a href="https://en.wikipedia.org/wiki/One-pass_compiler" style="font-size: 16px !important;">single
pass</a>, meaning it should be
possible to compile each part of a program without knowing what comes later in
the program.</p>

<p style="font-size: 16px !important;">When we call a function in C, the compiler needs to know the arguments and
return value of that function. We can tell the compiler this information about
<code style="font-size: 12px !important;">editorSetStatusMessage()</code> by declaring a function prototype for it near the
top of the file. This allows us to call the function before it is defined.
We’ll add a new <code style="font-size: 12px !important;">/*** prototypes ***/</code> section and put the declaration under
it.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/prototypes/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 110</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/prototypes" style="font-size: 16px !important;">prototypes</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="k" style="font-size: 12px !important;">typedef</span> <span class="k" style="font-size: 12px !important;">struct</span> <span class="n" style="font-size: 12px !important;">erow</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span> <span class="n" style="font-size: 12px !important;">erow</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="k" style="font-size: 12px !important;">struct</span> <span class="n" style="font-size: 12px !important;">editorConfig</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">};</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="k" style="font-size: 12px !important;">struct</span> <span class="n" style="font-size: 12px !important;">editorConfig</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></ins><ins class="line" style="font-size: 12px !important;"></ins><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="k" style="font-size: 12px !important;">const</span> <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">fmt</span><span class="p" style="font-size: 12px !important;">,</span> <span class="p" style="font-size: 12px !important;">...);</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>

<h2 id="dirty-flag" style="font-size: 24px !important;"><a href="#dirty-flag" style="font-size: 24px !important;">Dirty flag</a></h2>

<p style="font-size: 16px !important;">We’d like to keep track of whether the text loaded in our editor differs from
what’s in the file. Then we can warn the user that they might lose unsaved
changes when they try to quit.</p>

<p style="font-size: 16px !important;">We call a text buffer “dirty” if it has been modified since opening or saving
the file. Let’s add a <code style="font-size: 12px !important;">dirty</code> variable to the global editor state, and
initialize it to <code style="font-size: 12px !important;">0</code>.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/dirty/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 111</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/dirty" style="font-size: 16px !important;">dirty</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="k" style="font-size: 12px !important;">typedef</span> <span class="k" style="font-size: 12px !important;">struct</span> <span class="n" style="font-size: 12px !important;">erow</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span> <span class="n" style="font-size: 12px !important;">erow</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="k" style="font-size: 12px !important;">struct</span> <span class="n" style="font-size: 12px !important;">editorConfig</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">cx</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">rx</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">rowoff</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">coloff</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">screenrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">screencols</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">;</span></div><ins class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">dirty</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="n" style="font-size: 12px !important;">statusmsg</span><span class="p" style="font-size: 12px !important;">[</span><span class="mi" style="font-size: 12px !important;">80</span><span class="p" style="font-size: 12px !important;">];</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">time_t</span> <span class="n" style="font-size: 12px !important;">statusmsg_time</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">struct</span> <span class="n" style="font-size: 12px !important;">termios</span> <span class="n" style="font-size: 12px !important;">orig_termios</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">};</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="k" style="font-size: 12px !important;">struct</span> <span class="n" style="font-size: 12px !important;">editorConfig</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">initEditor</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">rx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">rowoff</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">coloff</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">;</span></div><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">statusmsg</span><span class="p" style="font-size: 12px !important;">[</span><span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="sc" style="font-size: 12px !important;">'\0'</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">statusmsg_time</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">getWindowSize</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screenrows</span><span class="p" style="font-size: 12px !important;">,</span> <span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screencols</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="o" style="font-size: 12px !important;">-</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">die</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"getWindowSize"</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screenrows</span> <span class="o" style="font-size: 12px !important;">-=</span> <span class="mi" style="font-size: 12px !important;">2</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">int</span> <span class="nf" style="font-size: 12px !important;">main</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">argc</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">argv</span><span class="p" style="font-size: 12px !important;">[])</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c1" style="font-size: 16px !important;">♎︎ compiles, but with no observable effects</div>
</div>
</div>


<p style="font-size: 16px !important;">Let’s show the state of <code style="font-size: 12px !important;">E.dirty</code> in the status bar, by displaying <code style="font-size: 12px !important;">(modified)</code>
after the filename if the file has been modified.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/show-dirty/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 112</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/show-dirty" style="font-size: 16px !important;">show-dirty</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorScroll</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorDrawRows</span><span class="p" style="font-size: 12px !important;">(</span><span class="k" style="font-size: 12px !important;">struct</span> <span class="n" style="font-size: 12px !important;">abuf</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">ab</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorDrawStatusBar</span><span class="p" style="font-size: 12px !important;">(</span><span class="k" style="font-size: 12px !important;">struct</span> <span class="n" style="font-size: 12px !important;">abuf</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">ab</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">abAppend</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">ab</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\x1b</span><span class="s" style="font-size: 12px !important;">[7m"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">4</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="n" style="font-size: 12px !important;">status</span><span class="p" style="font-size: 12px !important;">[</span><span class="mi" style="font-size: 12px !important;">80</span><span class="p" style="font-size: 12px !important;">],</span> <span class="n" style="font-size: 12px !important;">rstatus</span><span class="p" style="font-size: 12px !important;">[</span><span class="mi" style="font-size: 12px !important;">80</span><span class="p" style="font-size: 12px !important;">];</span></div><ins class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">len</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">snprintf</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">status</span><span class="p" style="font-size: 12px !important;">,</span> <span class="k" style="font-size: 12px !important;">sizeof</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">status</span><span class="p" style="font-size: 12px !important;">),</span> <span class="s" style="font-size: 12px !important;">"%.20s - %d lines %s"</span><span class="p" style="font-size: 12px !important;">,</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span> <span class="o" style="font-size: 12px !important;">?</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span> <span class="o" style="font-size: 12px !important;">:</span> <span class="s" style="font-size: 12px !important;">"[No Name]"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">,</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span> <span class="o" style="font-size: 12px !important;">?</span> <span class="s" style="font-size: 12px !important;">"(modified)"</span> <span class="o" style="font-size: 12px !important;">:</span> <span class="s" style="font-size: 12px !important;">""</span><span class="p" style="font-size: 12px !important;">);</span></ins><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">rlen</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">snprintf</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">rstatus</span><span class="p" style="font-size: 12px !important;">,</span> <span class="k" style="font-size: 12px !important;">sizeof</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">rstatus</span><span class="p" style="font-size: 12px !important;">),</span> <span class="s" style="font-size: 12px !important;">"%d/%d"</span><span class="p" style="font-size: 12px !important;">,</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">len</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screencols</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">len</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screencols</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">abAppend</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">ab</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">status</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">len</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screencols</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screencols</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="n" style="font-size: 12px !important;">len</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">rlen</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">abAppend</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">ab</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">rstatus</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">rlen</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">abAppend</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">ab</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">" "</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">len</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">abAppend</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">ab</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\x1b</span><span class="s" style="font-size: 12px !important;">[m"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">3</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">abAppend</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">ab</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\r\n</span><span class="s" style="font-size: 12px !important;">"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">2</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorDrawMessageBar</span><span class="p" style="font-size: 12px !important;">(</span><span class="k" style="font-size: 12px !important;">struct</span> <span class="n" style="font-size: 12px !important;">abuf</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">ab</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorRefreshScreen</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="k" style="font-size: 12px !important;">const</span> <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">fmt</span><span class="p" style="font-size: 12px !important;">,</span> <span class="p" style="font-size: 12px !important;">...)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c1" style="font-size: 16px !important;">♎︎ compiles, but with no observable effects</div>
</div>
</div>


<p style="font-size: 16px !important;">Now let’s increment <code style="font-size: 12px !important;">E.dirty</code> in each row operation that makes a change to the
text.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/increment-dirty/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 113</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/increment-dirty" style="font-size: 16px !important;">increment-dirty</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">int</span> <span class="nf" style="font-size: 12px !important;">editorRowCxToRx</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">cx</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorUpdateRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorAppendRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">s</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">realloc</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="k" style="font-size: 12px !important;">sizeof</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">*</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">));</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">size</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">chars</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">malloc</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">len</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">memcpy</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">s</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="sc" style="font-size: 12px !important;">'\0'</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">rsize</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">render</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">editorUpdateRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">]);</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></div><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorRowInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="mi" style="font-size: 12px !important;">0</span> <span class="o" style="font-size: 12px !important;">||</span> <span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">realloc</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">2</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">memmove</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">],</span> <span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">],</span> <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">editorUpdateRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">);</span></div><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>


<p style="font-size: 16px !important;">We could have used <code style="font-size: 12px !important;">E.dirty = 1</code> instead of <code style="font-size: 12px !important;">E.dirty++</code>, but by incrementing it
we can have a sense of “how dirty” the file is, which could be useful. (We’ll
just be treating <code style="font-size: 12px !important;">E.dirty</code> as a boolean value in this tutorial, so it doesn’t
really matter.)</p>

<p style="font-size: 16px !important;">If you open a file at this point, you’ll see that <code style="font-size: 12px !important;">(modified)</code> appears right
away, before you make any changes. That’s because <code style="font-size: 12px !important;">editorOpen()</code> calls
<code style="font-size: 12px !important;">editorAppendRow()</code>, which increments <code style="font-size: 12px !important;">E.dirty</code>. To fix that, let’s reset
<code style="font-size: 12px !important;">E.dirty</code> to <code style="font-size: 12px !important;">0</code> at the end of <code style="font-size: 12px !important;">editorOpen()</code>, and also in <code style="font-size: 12px !important;">editorSave()</code>.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/reset-dirty/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 114</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/reset-dirty" style="font-size: 16px !important;">reset-dirty</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="nf" style="font-size: 12px !important;">editorRowsToString</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorOpen</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">strdup</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">FILE</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">fp</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">fopen</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"r"</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">!</span><span class="n" style="font-size: 12px !important;">fp</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">die</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"fopen"</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">line</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">linecap</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">ssize_t</span> <span class="n" style="font-size: 12px !important;">linelen</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">((</span><span class="n" style="font-size: 12px !important;">linelen</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">getline</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">line</span><span class="p" style="font-size: 12px !important;">,</span> <span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">linecap</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">fp</span><span class="p" style="font-size: 12px !important;">))</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="o" style="font-size: 12px !important;">-</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">linelen</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="mi" style="font-size: 12px !important;">0</span> <span class="o" style="font-size: 12px !important;">&amp;&amp;</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">line</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">linelen</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="sc" style="font-size: 12px !important;">'\n'</span> <span class="o" style="font-size: 12px !important;">||</span></div><div class="line" style="font-size: 12px !important;">                           <span class="n" style="font-size: 12px !important;">line</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">linelen</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="sc" style="font-size: 12px !important;">'\r'</span><span class="p" style="font-size: 12px !important;">))</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">linelen</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorAppendRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">line</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">linelen</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">line</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">fclose</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fp</span><span class="p" style="font-size: 12px !important;">);</span></div><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorSave</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">)</span> <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buf</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorRowsToString</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">fd</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">open</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">O_RDWR</span> <span class="o" style="font-size: 12px !important;">|</span> <span class="n" style="font-size: 12px !important;">O_CREAT</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mo" style="font-size: 12px !important;">0644</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="o" style="font-size: 12px !important;">-</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">ftruncate</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="o" style="font-size: 12px !important;">-</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">close</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></div><ins class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"%d bytes written to disk"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">close</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"Can't save! I/O error: %s"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">strerror</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">errno</span><span class="p" style="font-size: 12px !important;">));</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>


<p style="font-size: 16px !important;">Now you should see <code style="font-size: 12px !important;">(modified)</code> appear in the status bar when you first insert
a character, and you should see it disappear when you save the file to disk.</p>
<h2 id="quit-confirmation" style="font-size: 24px !important;"><a href="#quit-confirmation" style="font-size: 24px !important;">Quit confirmation</a></h2>

<p style="font-size: 16px !important;">Now we’re ready to warn the user about unsaved changes when they try to quit.
If <code style="font-size: 12px !important;">E.dirty</code> is set, we will display a warning in the status bar, and require
the user to press <kbd style="font-size: 12px !important;">Ctrl-Q</kbd> three more times in order to quit without
saving.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/quit-confirmation/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 115</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/quit-confirmation" style="font-size: 16px !important;">quit-confirmation</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#define KILO_VERSION "0.0.1"</span></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#define KILO_TAB_STOP 8</span></div><ins class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#define KILO_QUIT_TIMES 3</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="cp" style="font-size: 12px !important;">#define CTRL_KEY(k) ((k) &amp; 0x1f)</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="k" style="font-size: 12px !important;">enum</span> <span class="n" style="font-size: 12px !important;">editorKey</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">};</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">key</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorProcessKeypress</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></div><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">static</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">quit_times</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">KILO_QUIT_TIMES</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorReadKey</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">switch</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="sc" style="font-size: 12px !important;">'\r'</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="cm" style="font-size: 12px !important;">/* TODO */</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'q'</span><span class="p" style="font-size: 12px !important;">):</span></div><ins class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span> <span class="o" style="font-size: 12px !important;">&amp;&amp;</span> <span class="n" style="font-size: 12px !important;">quit_times</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"WARNING!!! File has unsaved changes. "</span></ins><ins class="line" style="font-size: 12px !important;">          <span class="s" style="font-size: 12px !important;">"Press Ctrl-Q %d more times to quit."</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">quit_times</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">quit_times</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></ins><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">STDOUT_FILENO</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\x1b</span><span class="s" style="font-size: 12px !important;">[2J"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">4</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">STDOUT_FILENO</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\x1b</span><span class="s" style="font-size: 12px !important;">[H"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">3</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">exit</span><span class="p" style="font-size: 12px !important;">(</span><span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'s'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorSave</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">HOME_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">END_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">BACKSPACE</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'h'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">DEL_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="cm" style="font-size: 12px !important;">/* TODO */</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">PAGE_DOWN</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">rowoff</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_DOWN</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">rowoff</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screenrows</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">          <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">        <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">times</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screenrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">times</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">)</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span> <span class="o" style="font-size: 12px !important;">?</span> <span class="n" style="font-size: 12px !important;">ARROW_UP</span> <span class="o" style="font-size: 12px !important;">:</span> <span class="n" style="font-size: 12px !important;">ARROW_DOWN</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_UP</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_DOWN</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_LEFT</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_RIGHT</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'l'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="sc" style="font-size: 12px !important;">'\x1b'</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="nl" style="font-size: 12px !important;">default:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">quit_times</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">KILO_QUIT_TIMES</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>


<p style="font-size: 16px !important;">We use a static variable in <code style="font-size: 12px !important;">editorProcessKeypress()</code> to keep track of how many
more times the user must press <kbd style="font-size: 12px !important;">Ctrl-Q</kbd> to quit. Each time they press
<kbd style="font-size: 12px !important;">Ctrl-Q</kbd> with unsaved changes, we set the status message and decrement
<code style="font-size: 12px !important;">quit_times</code>. When <code style="font-size: 12px !important;">quit_times</code> gets to <code style="font-size: 12px !important;">0</code>, we finally allow the program to
exit. When they press any key other than <kbd style="font-size: 12px !important;">Ctrl-Q</kbd>, then <code style="font-size: 12px !important;">quit_times</code>
gets reset back to <code style="font-size: 12px !important;">3</code> at the end of the <code style="font-size: 12px !important;">editorProcessKeypress()</code> function.</p>
<h2 id="simple-backspacing" style="font-size: 24px !important;"><a href="#simple-backspacing" style="font-size: 24px !important;">Simple backspacing</a></h2>

<p style="font-size: 16px !important;">Let’s implement backspacing next. First we’ll create an <code style="font-size: 12px !important;">editorRowDelChar()</code>
function, which deletes a character in an <code style="font-size: 12px !important;">erow</code>.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/row-del-char/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 116</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/row-del-char" style="font-size: 16px !important;">row-del-char</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">int</span> <span class="nf" style="font-size: 12px !important;">editorRowCxToRx</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">cx</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorUpdateRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorAppendRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">s</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorRowInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorRowDelChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="mi" style="font-size: 12px !important;">0</span> <span class="o" style="font-size: 12px !important;">||</span> <span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">&gt;=</span> <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">)</span> <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">memmove</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">],</span> <span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">],</span> <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">editorUpdateRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c1" style="font-size: 16px !important;">♎︎ compiles, but with no observable effects</div>
</div>
</div>


<p style="font-size: 16px !important;">As you can see, it’s very similar to <code style="font-size: 12px !important;">editorRowInsertChar()</code>, except we don’t
have any memory management to do. We just use <code style="font-size: 12px !important;">memmove()</code> to overwrite the
deleted character with the characters that come after it (notice that the null
byte at the end gets included in the move). Then we decrement the row’s <code style="font-size: 12px !important;">size</code>,
call <code style="font-size: 12px !important;">editorUpdateRow()</code>, and increment <code style="font-size: 12px !important;">E.dirty</code>.</p>

<p style="font-size: 16px !important;">Now let’s implement <code style="font-size: 12px !important;">editorDelChar()</code>, which uses <code style="font-size: 12px !important;">editorRowDelChar()</code> to
delete the character that is to the left of the cursor.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/editor-del-char/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 117</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/editor-del-char" style="font-size: 16px !important;">editor-del-char</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorDelChar</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span> <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;"></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">];</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorRowDelChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></ins><ins class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c1" style="font-size: 16px !important;">♎︎ compiles, but with no observable effects</div>
</div>
</div>


<p style="font-size: 16px !important;">If the cursor’s past the end of the file, then there is nothing to delete, and
we <code style="font-size: 12px !important;">return</code> immediately. Otherwise, we get the <code style="font-size: 12px !important;">erow</code> the cursor is on, and if
there is a character to the left of the cursor, we delete it and move the
cursor one to the left.</p>

<p style="font-size: 16px !important;">Let’s map the <kbd style="font-size: 12px !important;">Backspace</kbd>, <kbd style="font-size: 12px !important;">Ctrl-H</kbd>, and <kbd style="font-size: 12px !important;">Delete</kbd>
keys to <code style="font-size: 12px !important;">editorDelChar()</code>.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/key-del-char/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 118</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/key-del-char" style="font-size: 16px !important;">key-del-char</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">key</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorProcessKeypress</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">static</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">quit_times</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">KILO_QUIT_TIMES</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorReadKey</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">switch</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="sc" style="font-size: 12px !important;">'\r'</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="cm" style="font-size: 12px !important;">/* TODO */</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'q'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span> <span class="o" style="font-size: 12px !important;">&amp;&amp;</span> <span class="n" style="font-size: 12px !important;">quit_times</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"WARNING!!! File has unsaved changes. "</span></div><div class="line" style="font-size: 12px !important;">          <span class="s" style="font-size: 12px !important;">"Press Ctrl-Q %d more times to quit."</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">quit_times</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">quit_times</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">STDOUT_FILENO</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\x1b</span><span class="s" style="font-size: 12px !important;">[2J"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">4</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">STDOUT_FILENO</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\x1b</span><span class="s" style="font-size: 12px !important;">[H"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">3</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">exit</span><span class="p" style="font-size: 12px !important;">(</span><span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'s'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorSave</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">HOME_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">END_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">BACKSPACE</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'h'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">DEL_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><ins class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">DEL_KEY</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">ARROW_RIGHT</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorDelChar</span><span class="p" style="font-size: 12px !important;">();</span></ins><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">PAGE_DOWN</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">rowoff</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_DOWN</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">rowoff</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screenrows</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">          <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">        <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">times</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screenrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">times</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">)</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span> <span class="o" style="font-size: 12px !important;">?</span> <span class="n" style="font-size: 12px !important;">ARROW_UP</span> <span class="o" style="font-size: 12px !important;">:</span> <span class="n" style="font-size: 12px !important;">ARROW_DOWN</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_UP</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_DOWN</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_LEFT</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_RIGHT</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'l'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="sc" style="font-size: 12px !important;">'\x1b'</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="nl" style="font-size: 12px !important;">default:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">quit_times</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">KILO_QUIT_TIMES</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>


<p style="font-size: 16px !important;">It so happens that in our editor, pressing the <kbd style="font-size: 12px !important;">→</kbd> key and then
<kbd style="font-size: 12px !important;">Backspace</kbd> is equivalent to what you would expect from pressing the
<kbd style="font-size: 12px !important;">Delete</kbd> key in a text editor: it deletes the character to the right
of the cursor. So that is how we implement the <kbd style="font-size: 12px !important;">Delete</kbd> key above.</p>
<h2 id="backspacing-at-the-start-of-a-line" style="font-size: 24px !important;"><a href="#backspacing-at-the-start-of-a-line" style="font-size: 24px !important;">Backspacing at the start of a line</a></h2>

<p style="font-size: 16px !important;">Currently, <code style="font-size: 12px !important;">editorDelChar()</code> doesn’t do anything when the cursor is at the
beginning of a line. When the user backspaces at the beginning of a line, we
want to append the contents of that line to the previous line, and then delete
the current line. This effectively backspaces the implicit <code style="font-size: 12px !important;">\n</code> character in
between the two lines to join them into one line.</p>

<p style="font-size: 16px !important;">So we need two new row operations: one for appending a string to a row, and one
for deleting a row. Let’s start by implementing <code style="font-size: 12px !important;">editorDelRow()</code>, which will
also require an <code style="font-size: 12px !important;">editorFreeRow()</code> function for freeing the memory owned by the
<code style="font-size: 12px !important;">erow</code> we are deleting.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/del-row/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 119</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/del-row" style="font-size: 16px !important;">del-row</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">int</span> <span class="nf" style="font-size: 12px !important;">editorRowCxToRx</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">cx</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorUpdateRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorAppendRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">s</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorFreeRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">render</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></ins><ins class="line" style="font-size: 12px !important;"></ins><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorDelRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="mi" style="font-size: 12px !important;">0</span> <span class="o" style="font-size: 12px !important;">||</span> <span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">&gt;=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span> <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">editorFreeRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">]);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">memmove</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">],</span> <span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">],</span> <span class="k" style="font-size: 12px !important;">sizeof</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">*</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">));</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorRowInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorRowDelChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c1" style="font-size: 16px !important;">♎︎ compiles, but with no observable effects</div>
</div>
</div>


<p style="font-size: 16px !important;"><code style="font-size: 12px !important;">editorDelRow()</code> looks a lot like <code style="font-size: 12px !important;">editorRowDelChar()</code>, because in both cases
we are deleting a single element from an array of elements by its index.</p>

<p style="font-size: 16px !important;">First we validate the <code style="font-size: 12px !important;">at</code> index. Then we free the memory owned by the row
using <code style="font-size: 12px !important;">editorFreeRow()</code>. We then use <code style="font-size: 12px !important;">memmove()</code> to overwrite the deleted row
struct with the rest of the rows that come after it, and decrement <code style="font-size: 12px !important;">numrows</code>.
Finally, we increment <code style="font-size: 12px !important;">E.dirty</code>.</p>

<p style="font-size: 16px !important;">Now let’s implement <code style="font-size: 12px !important;">editorRowAppendString()</code>, which appends a string to the
end of a row.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/row-append-string/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 120</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/row-append-string" style="font-size: 16px !important;">row-append-string</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">int</span> <span class="nf" style="font-size: 12px !important;">editorRowCxToRx</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">cx</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorUpdateRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorAppendRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">s</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorFreeRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorDelRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorRowInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorRowAppendString</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">s</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">realloc</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="n" style="font-size: 12px !important;">len</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">memcpy</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">],</span> <span class="n" style="font-size: 12px !important;">s</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span> <span class="o" style="font-size: 12px !important;">+=</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="sc" style="font-size: 12px !important;">'\0'</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">editorUpdateRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorRowDelChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c1" style="font-size: 16px !important;">♎︎ compiles, but with no observable effects</div>
</div>
</div>


<p style="font-size: 16px !important;">The row’s new size is <code style="font-size: 12px !important;">row-&gt;size + len + 1</code> (including the null byte), so first
we allocate that much memory for <code style="font-size: 12px !important;">row-&gt;chars</code>. Then we simply <code style="font-size: 12px !important;">memcpy()</code> the
given string to the end of the contents of <code style="font-size: 12px !important;">row-&gt;chars</code>. We update <code style="font-size: 12px !important;">row-&gt;size</code>,
call <code style="font-size: 12px !important;">editorUpdateRow()</code> as usual, and increment <code style="font-size: 12px !important;">E.dirty</code> as usual.</p>

<p style="font-size: 16px !important;">Now we’re ready to get <code style="font-size: 12px !important;">editorDelChar()</code> to handle the case where the cursor is
at the beginning of a line.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/del-char-row/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 121</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/del-char-row" style="font-size: 16px !important;">del-char-row</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorDelChar</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span> <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></div><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="mi" style="font-size: 12px !important;">0</span> <span class="o" style="font-size: 12px !important;">&amp;&amp;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">)</span> <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">];</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorRowDelChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">;</span></div><ins class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorRowAppendString</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">],</span> <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorDelRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">;</span></ins><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>


<p style="font-size: 16px !important;">If the cursor is at the beginning of the <em style="font-size: 16px !important;">first</em> line, then there’s nothing to
do, so we <code style="font-size: 12px !important;">return</code> immediately. Otherwise, if we find that <code style="font-size: 12px !important;">E.cx == 0</code>, we call
<code style="font-size: 12px !important;">editorRowAppendString()</code> and then <code style="font-size: 12px !important;">editorDelRow()</code> as we planned. <code style="font-size: 12px !important;">row</code> points
to the row we are deleting, so we append <code style="font-size: 12px !important;">row-&gt;chars</code> to the previous row, and
then delete the row that <code style="font-size: 12px !important;">E.cy</code> is on. We set <code style="font-size: 12px !important;">E.cx</code> to the end of the contents
of the previous row before appending to that row. That way, the cursor will end
up at the point where the two lines joined.</p>

<p style="font-size: 16px !important;">Notice that pressing the <kbd style="font-size: 12px !important;">Delete</kbd> key at the end of a line works as
the user would expect, joining the current line with the next line. This is
because moving the cursor to the right at the end of a line moves it to the
beginning of the next line. So making the <kbd style="font-size: 12px !important;">Delete</kbd> key an alias for
the <kbd style="font-size: 12px !important;">→</kbd> key followed by the <kbd style="font-size: 12px !important;">Backspace</kbd> key still works.</p>
<h2 id="the-enter-key" style="font-size: 24px !important;"><a href="#the-enter-key" style="font-size: 24px !important;">The <kbd style="font-size: 18px !important;">Enter</kbd> key</a></h2>

<p style="font-size: 16px !important;">The last editor operation we have to implement is the <kbd style="font-size: 12px !important;">Enter</kbd> key. The
<kbd style="font-size: 12px !important;">Enter</kbd> key allows the user to insert new lines into the text, or
split a line into two lines. The first thing we need to do is rename the
<code style="font-size: 12px !important;">editorAppendRow(...)</code> function to <code style="font-size: 12px !important;">editorInsertRow(int at, ...)</code>. It will now
be able to insert a row at the index specified by the new <code style="font-size: 12px !important;">at</code> argument.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/append-to-insert/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 122</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/append-to-insert" style="font-size: 16px !important;">append-to-insert</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">int</span> <span class="nf" style="font-size: 12px !important;">editorRowCxToRx</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">cx</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorUpdateRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorInsertRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">s</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="mi" style="font-size: 12px !important;">0</span> <span class="o" style="font-size: 12px !important;">||</span> <span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span> <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;"></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">realloc</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="k" style="font-size: 12px !important;">sizeof</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">*</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">));</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">memmove</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">],</span> <span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">],</span> <span class="k" style="font-size: 12px !important;">sizeof</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">*</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">));</span></ins><div class="line" style="font-size: 12px !important;"></div><del class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">;</span></del><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">size</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">chars</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">malloc</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">len</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">memcpy</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">s</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="sc" style="font-size: 12px !important;">'\0'</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">rsize</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">render</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">editorUpdateRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">]);</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorFreeRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorDelRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorRowInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorRowAppendString</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">s</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorRowDelChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">,</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">at</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c0" style="font-size: 16px !important;">♏︎ doesn’t compile</div>
</div>
</div>


<p style="font-size: 16px !important;">Much like <code style="font-size: 12px !important;">editorRowInsertChar()</code>, we first validate <code style="font-size: 12px !important;">at</code>, then allocate memory
for one more <code style="font-size: 12px !important;">erow</code>, and use <code style="font-size: 12px !important;">memmove()</code> to make room at the specified index
for the new row.</p>

<p style="font-size: 16px !important;">We also delete the old <code style="font-size: 12px !important;">int at = ...</code> line, since <code style="font-size: 12px !important;">at</code> is now being passed in
as an argument.</p>

<p style="font-size: 16px !important;">We now have to replace all calls to <code style="font-size: 12px !important;">editorAppendRow(...)</code> with calls to
<code style="font-size: 12px !important;">editorInsertRow(E.numrows, ...)</code>.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/use-insert-row/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 123</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/use-insert-row" style="font-size: 16px !important;">use-insert-row</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorInsertRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">""</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">);</span></ins><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">editorRowInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">],</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorDelChar</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="nf" style="font-size: 12px !important;">editorRowsToString</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorOpen</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">strdup</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">FILE</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">fp</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">fopen</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"r"</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">!</span><span class="n" style="font-size: 12px !important;">fp</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">die</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"fopen"</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">line</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">linecap</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">ssize_t</span> <span class="n" style="font-size: 12px !important;">linelen</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">((</span><span class="n" style="font-size: 12px !important;">linelen</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">getline</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">line</span><span class="p" style="font-size: 12px !important;">,</span> <span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">linecap</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">fp</span><span class="p" style="font-size: 12px !important;">))</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="o" style="font-size: 12px !important;">-</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">linelen</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="mi" style="font-size: 12px !important;">0</span> <span class="o" style="font-size: 12px !important;">&amp;&amp;</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">line</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">linelen</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="sc" style="font-size: 12px !important;">'\n'</span> <span class="o" style="font-size: 12px !important;">||</span></div><div class="line" style="font-size: 12px !important;">                           <span class="n" style="font-size: 12px !important;">line</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">linelen</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="sc" style="font-size: 12px !important;">'\r'</span><span class="p" style="font-size: 12px !important;">))</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">linelen</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">;</span></div><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorInsertRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">line</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">linelen</span><span class="p" style="font-size: 12px !important;">);</span></ins><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">line</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">fclose</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fp</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorSave</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c1" style="font-size: 16px !important;">♎︎ compiles, but with no observable effects</div>
</div>
</div>


<p style="font-size: 16px !important;">Now that we have <code style="font-size: 12px !important;">editorInsertRow()</code>, we’re ready to implement
<code style="font-size: 12px !important;">editorInsertNewline()</code>, which handles an <kbd style="font-size: 12px !important;">Enter</kbd> keypress.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/insert-newline/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 124</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/insert-newline" style="font-size: 16px !important;">insert-newline</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorInsertNewline</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorInsertRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">""</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">erow</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">row</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">];</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorInsertRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">,</span> <span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span><span class="p" style="font-size: 12px !important;">],</span> <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">row</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">];</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">chars</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">row</span><span class="o" style="font-size: 12px !important;">-&gt;</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="sc" style="font-size: 12px !important;">'\0'</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorUpdateRow</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorDelChar</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c1" style="font-size: 16px !important;">♎︎ compiles, but with no observable effects</div>
</div>
</div>


<p style="font-size: 16px !important;">If we’re at the beginning of a line, all we have to do is insert a new blank
row before the line we’re on.</p>

<p style="font-size: 16px !important;">Otherwise, we have to split the line we’re on into two rows. First we call
<code style="font-size: 12px !important;">editorInsertRow()</code> and pass it the characters on the current row that are to
the right of the cursor. That creates a new row after the current one, with the
correct contents. Then we reassign the <code style="font-size: 12px !important;">row</code> pointer, because
<code style="font-size: 12px !important;">editorInsertRow()</code> calls <code style="font-size: 12px !important;">realloc()</code>, which might move memory around on us and
invalidate the pointer (yikes). Then we truncate the current row’s contents by
setting its size to the position of the cursor, and we call
<code style="font-size: 12px !important;">editorUpdateRow()</code> on the truncated row. (<code style="font-size: 12px !important;">editorInsertRow()</code> already calls
<code style="font-size: 12px !important;">editorUpdateRow()</code> for the new row.)</p>

<p style="font-size: 16px !important;">In both cases, we increment <code style="font-size: 12px !important;">E.cy</code>, and set <code style="font-size: 12px !important;">E.cx</code> to <code style="font-size: 12px !important;">0</code> to move the cursor to
the beginning of the row.</p>

<p style="font-size: 16px !important;">Finally, let’s actually map the <kbd style="font-size: 12px !important;">Enter</kbd> key to the
<code style="font-size: 12px !important;">editorInsertNewline()</code> operation.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/enter-key/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 125</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/enter-key" style="font-size: 16px !important;">enter-key</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">key</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorProcessKeypress</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">static</span> <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">quit_times</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">KILO_QUIT_TIMES</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorReadKey</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">switch</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="sc" style="font-size: 12px !important;">'\r'</span><span class="p" style="font-size: 12px !important;">:</span></div><ins class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorInsertNewline</span><span class="p" style="font-size: 12px !important;">();</span></ins><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'q'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span> <span class="o" style="font-size: 12px !important;">&amp;&amp;</span> <span class="n" style="font-size: 12px !important;">quit_times</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"WARNING!!! File has unsaved changes. "</span></div><div class="line" style="font-size: 12px !important;">          <span class="s" style="font-size: 12px !important;">"Press Ctrl-Q %d more times to quit."</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">quit_times</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">quit_times</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">STDOUT_FILENO</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\x1b</span><span class="s" style="font-size: 12px !important;">[2J"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">4</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">STDOUT_FILENO</span><span class="p" style="font-size: 12px !important;">,</span> <span class="s" style="font-size: 12px !important;">"</span><span class="se" style="font-size: 12px !important;">\x1b</span><span class="s" style="font-size: 12px !important;">[H"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mi" style="font-size: 12px !important;">3</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">exit</span><span class="p" style="font-size: 12px !important;">(</span><span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'s'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorSave</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">HOME_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">END_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cx</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">row</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span><span class="p" style="font-size: 12px !important;">].</span><span class="n" style="font-size: 12px !important;">size</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">BACKSPACE</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'h'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">DEL_KEY</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">DEL_KEY</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">ARROW_RIGHT</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorDelChar</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">PAGE_DOWN</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">rowoff</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_DOWN</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">rowoff</span> <span class="o" style="font-size: 12px !important;">+</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screenrows</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">          <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">&gt;</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">cy</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">numrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">        <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">times</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">screenrows</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">times</span><span class="o" style="font-size: 12px !important;">--</span><span class="p" style="font-size: 12px !important;">)</span></div><div class="line" style="font-size: 12px !important;">          <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">PAGE_UP</span> <span class="o" style="font-size: 12px !important;">?</span> <span class="n" style="font-size: 12px !important;">ARROW_UP</span> <span class="o" style="font-size: 12px !important;">:</span> <span class="n" style="font-size: 12px !important;">ARROW_DOWN</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_UP</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_DOWN</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_LEFT</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">ARROW_RIGHT</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'l'</span><span class="p" style="font-size: 12px !important;">):</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">case</span> <span class="sc" style="font-size: 12px !important;">'\x1b'</span><span class="p" style="font-size: 12px !important;">:</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="nl" style="font-size: 12px !important;">default:</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorInsertChar</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">break</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">quit_times</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">KILO_QUIT_TIMES</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>


<p style="font-size: 16px !important;">That concludes all of the text editing operations we are going to implement. If
you wish, and if you are brave enough, you may now start using the editor to
modify its own code for the rest of the tutorial. If you do, I suggest making
regular backups of your work (using <code style="font-size: 12px !important;">git</code> or similar) in case you run into bugs
in the editor.</p>
<h2 id="save-as" style="font-size: 24px !important;"><a href="#save-as" style="font-size: 24px !important;">Save as…</a></h2>

<p style="font-size: 16px !important;">Currently, when the user runs <code style="font-size: 12px !important;">./kilo</code> with no arguments, they get a blank file
to edit but have no way of saving. We need a way of prompting the user to input
a filename when saving a new file. Let’s make an <code style="font-size: 12px !important;">editorPrompt()</code> function that
displays a prompt in the status bar, and lets the user input a line of text
after the prompt.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/prompt/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 126</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/prompt" style="font-size: 16px !important;">prompt</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="k" style="font-size: 12px !important;">const</span> <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">fmt</span><span class="p" style="font-size: 12px !important;">,</span> <span class="p" style="font-size: 12px !important;">...);</span></div><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorRefreshScreen</span><span class="p" style="font-size: 12px !important;">();</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line" style="font-size: 12px !important;"></div><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="nf" style="font-size: 12px !important;">editorPrompt</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">prompt</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">bufsize</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">128</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buf</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">malloc</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">bufsize</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;"></ins><ins class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">buflen</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">[</span><span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="sc" style="font-size: 12px !important;">'\0'</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;"></ins><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">(</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">prompt</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorRefreshScreen</span><span class="p" style="font-size: 12px !important;">();</span></ins><ins class="line" style="font-size: 12px !important;"></ins><ins class="line" style="font-size: 12px !important;">    <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorReadKey</span><span class="p" style="font-size: 12px !important;">();</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="sc" style="font-size: 12px !important;">'\r'</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buflen</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">""</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">return</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">!</span><span class="n" style="font-size: 12px !important;">iscntrl</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">&amp;&amp;</span> <span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="mi" style="font-size: 12px !important;">128</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buflen</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">bufsize</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">bufsize</span> <span class="o" style="font-size: 12px !important;">*=</span> <span class="mi" style="font-size: 12px !important;">2</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">buf</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">realloc</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">bufsize</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="sc" style="font-size: 12px !important;">'\0'</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></ins><ins class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">key</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorProcessKeypress</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c1" style="font-size: 16px !important;">♎︎ compiles, but with no observable effects</div>
</div>
</div>


<p style="font-size: 16px !important;">The user’s input is stored in <code style="font-size: 12px !important;">buf</code>, which is a dynamically allocated string
that we initalize to the empty string. We then enter an infinite loop that
repeatedly sets the status message, refreshes the screen, and waits for a
keypress to handle. The <code style="font-size: 12px !important;">prompt</code> is expected to be a format string containing a
<code style="font-size: 12px !important;">%s</code>, which is where the user’s input will be displayed.</p>

<p style="font-size: 16px !important;">When the user presses <kbd style="font-size: 12px !important;">Enter</kbd>, and their input is not empty, the
status message is cleared and their input is returned. Otherwise, when they
input a printable character, we append it to <code style="font-size: 12px !important;">buf</code>. If <code style="font-size: 12px !important;">buflen</code> has reached the
maximum capacity we allocated (stored in <code style="font-size: 12px !important;">bufsize</code>), then we double <code style="font-size: 12px !important;">bufsize</code>
and allocate that amount of memory before appending to <code style="font-size: 12px !important;">buf</code>. We also make sure
that <code style="font-size: 12px !important;">buf</code> ends with a <code style="font-size: 12px !important;">\0</code> character, because both <code style="font-size: 12px !important;">editorSetStatusMessage()</code>
and the caller of <code style="font-size: 12px !important;">editorPrompt()</code> will use it to know where the string ends.</p>

<p style="font-size: 16px !important;">Notice that we have to make sure the input key isn’t one of the special keys in
the <code style="font-size: 12px !important;">editorKey</code> enum, which have high integer values. To do that, we test
whether the input key is in the range of a <code style="font-size: 12px !important;">char</code> by making sure it is less
than <code style="font-size: 12px !important;">128</code>.</p>

<p style="font-size: 16px !important;">Now let’s prompt the user for a filename in <code style="font-size: 12px !important;">editorSave()</code>, when <code style="font-size: 12px !important;">E.filename</code>
is <code style="font-size: 12px !important;">NULL</code>.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/save-as/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 127</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/save-as" style="font-size: 16px !important;">save-as</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="k" style="font-size: 12px !important;">const</span> <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">fmt</span><span class="p" style="font-size: 12px !important;">,</span> <span class="p" style="font-size: 12px !important;">...);</span></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorRefreshScreen</span><span class="p" style="font-size: 12px !important;">();</span></div><ins class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">editorPrompt</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">prompt</span><span class="p" style="font-size: 12px !important;">);</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="nf" style="font-size: 12px !important;">editorRowsToString</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorOpen</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorSave</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></div><ins class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorPrompt</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"Save as: %s"</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></ins><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buf</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorRowsToString</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">fd</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">open</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">O_RDWR</span> <span class="o" style="font-size: 12px !important;">|</span> <span class="n" style="font-size: 12px !important;">O_CREAT</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mo" style="font-size: 12px !important;">0644</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="o" style="font-size: 12px !important;">-</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">ftruncate</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="o" style="font-size: 12px !important;">-</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">close</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"%d bytes written to disk"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">close</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"Can't save! I/O error: %s"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">strerror</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">errno</span><span class="p" style="font-size: 12px !important;">));</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>


<p style="font-size: 16px !important;">Great, we now have basic “Save as…” functionality. Next, let’s allow the user 
to press <kbd style="font-size: 12px !important;">Escape</kbd> to cancel the input prompt.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/prompt-escape/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 128</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/prompt-escape" style="font-size: 16px !important;">prompt-escape</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="nf" style="font-size: 12px !important;">editorPrompt</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">prompt</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">bufsize</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">128</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buf</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">malloc</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">bufsize</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">buflen</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">[</span><span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="sc" style="font-size: 12px !important;">'\0'</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">(</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">prompt</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorRefreshScreen</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorReadKey</span><span class="p" style="font-size: 12px !important;">();</span></div><ins class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="sc" style="font-size: 12px !important;">'\x1b'</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">""</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">return</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="sc" style="font-size: 12px !important;">'\r'</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buflen</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">""</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">return</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">!</span><span class="n" style="font-size: 12px !important;">iscntrl</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">&amp;&amp;</span> <span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="mi" style="font-size: 12px !important;">128</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buflen</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">bufsize</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">bufsize</span> <span class="o" style="font-size: 12px !important;">*=</span> <span class="mi" style="font-size: 12px !important;">2</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">buf</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">realloc</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">bufsize</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="sc" style="font-size: 12px !important;">'\0'</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">key</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorProcessKeypress</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>


<p style="font-size: 16px !important;">When an input prompt is cancelled, we <code style="font-size: 12px !important;">free()</code> the <code style="font-size: 12px !important;">buf</code> ourselves and return
<code style="font-size: 12px !important;">NULL</code>. So let’s handle a return value of <code style="font-size: 12px !important;">NULL</code> in <code style="font-size: 12px !important;">editorSave()</code> by aborting
the save operation and displaying a “Save aborted” message to the user.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/abort-save/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 129</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/abort-save" style="font-size: 16px !important;">abort-save</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="nf" style="font-size: 12px !important;">editorRowsToString</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorOpen</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="nf" style="font-size: 12px !important;">editorSave</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><ins class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorPrompt</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"Save as: %s (ESC to cancel)"</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"Save aborted"</span><span class="p" style="font-size: 12px !important;">);</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span></ins><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buf</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorRowsToString</span><span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">&amp;</span><span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">fd</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">open</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">filename</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">O_RDWR</span> <span class="o" style="font-size: 12px !important;">|</span> <span class="n" style="font-size: 12px !important;">O_CREAT</span><span class="p" style="font-size: 12px !important;">,</span> <span class="mo" style="font-size: 12px !important;">0644</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="o" style="font-size: 12px !important;">-</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">ftruncate</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="o" style="font-size: 12px !important;">-</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">write</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">close</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">E</span><span class="p" style="font-size: 12px !important;">.</span><span class="n" style="font-size: 12px !important;">dirty</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"%d bytes written to disk"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">len</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">return</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">close</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">fd</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">"Can't save! I/O error: %s"</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">strerror</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">errno</span><span class="p" style="font-size: 12px !important;">));</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>


<p style="font-size: 16px !important;">(Note: If you’re using <strong style="font-size: 16px !important;">Bash on Windows</strong>, you will have to press
<kbd style="font-size: 12px !important;">Escape</kbd> 3 times to get one <kbd style="font-size: 12px !important;">Escape</kbd> keypress to register in
our program, because the <code style="font-size: 12px !important;">read()</code> calls in <code style="font-size: 12px !important;">editorReadKey()</code> that look for an
escape sequence never time out.)</p>

<p style="font-size: 16px !important;">Now let’s allow the user to press <kbd style="font-size: 12px !important;">Backspace</kbd> (or <kbd style="font-size: 12px !important;">Ctrl-H</kbd>,
or <kbd style="font-size: 12px !important;">Delete</kbd>) in the input prompt.</p>

<div class="diff" style="font-size: 16px !important;">
<div class="diff-header" style="font-size: 16px !important;">
  <div class="step-filename" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/blob/prompt-backspace/kilo.c" style="font-size: 16px !important;">kilo.c</a></div>
  <div class="step-number" style="font-size: 16px !important;">Step 130</div>
  <div class="step-name" style="font-size: 16px !important;"><a href="https://github.com/snaptoken/kilo-src/tree/prompt-backspace" style="font-size: 16px !important;">prompt-backspace</a></div>
</div><pre class="highlight" style="font-size: 12px !important;"><code style="font-size: 12px !important;"><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** includes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** defines ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** data ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** prototypes ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** terminal ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** row operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** editor operations ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** file i/o ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** append buffer ***/</span></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** output ***/</span></div><div class="line" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** input ***/</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="nf" style="font-size: 12px !important;">editorPrompt</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">prompt</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">bufsize</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">128</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">char</span> <span class="o" style="font-size: 12px !important;">*</span><span class="n" style="font-size: 12px !important;">buf</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">malloc</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">bufsize</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="kt" style="font-size: 12px !important;">size_t</span> <span class="n" style="font-size: 12px !important;">buflen</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">  <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">[</span><span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="sc" style="font-size: 12px !important;">'\0'</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">  <span class="k" style="font-size: 12px !important;">while</span> <span class="p" style="font-size: 12px !important;">(</span><span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">prompt</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">    <span class="n" style="font-size: 12px !important;">editorRefreshScreen</span><span class="p" style="font-size: 12px !important;">();</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line" style="font-size: 12px !important;">    <span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">editorReadKey</span><span class="p" style="font-size: 12px !important;">();</span></div><ins class="line" style="font-size: 12px !important;">    <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">DEL_KEY</span> <span class="o" style="font-size: 12px !important;">||</span> <span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">CTRL_KEY</span><span class="p" style="font-size: 12px !important;">(</span><span class="sc" style="font-size: 12px !important;">'h'</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">||</span> <span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">BACKSPACE</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><ins class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buflen</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">)</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">[</span><span class="o" style="font-size: 12px !important;">--</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="sc" style="font-size: 12px !important;">'\0'</span><span class="p" style="font-size: 12px !important;">;</span></ins><ins class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="sc" style="font-size: 12px !important;">'\x1b'</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></ins><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">""</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">free</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">return</span> <span class="nb" style="font-size: 12px !important;">NULL</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="sc" style="font-size: 12px !important;">'\r'</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buflen</span> <span class="o" style="font-size: 12px !important;">!=</span> <span class="mi" style="font-size: 12px !important;">0</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">editorSetStatusMessage</span><span class="p" style="font-size: 12px !important;">(</span><span class="s" style="font-size: 12px !important;">""</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">        <span class="k" style="font-size: 12px !important;">return</span> <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span> <span class="k" style="font-size: 12px !important;">else</span> <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="o" style="font-size: 12px !important;">!</span><span class="n" style="font-size: 12px !important;">iscntrl</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">)</span> <span class="o" style="font-size: 12px !important;">&amp;&amp;</span> <span class="n" style="font-size: 12px !important;">c</span> <span class="o" style="font-size: 12px !important;">&lt;</span> <span class="mi" style="font-size: 12px !important;">128</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">      <span class="k" style="font-size: 12px !important;">if</span> <span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buflen</span> <span class="o" style="font-size: 12px !important;">==</span> <span class="n" style="font-size: 12px !important;">bufsize</span> <span class="o" style="font-size: 12px !important;">-</span> <span class="mi" style="font-size: 12px !important;">1</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">bufsize</span> <span class="o" style="font-size: 12px !important;">*=</span> <span class="mi" style="font-size: 12px !important;">2</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">        <span class="n" style="font-size: 12px !important;">buf</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">realloc</span><span class="p" style="font-size: 12px !important;">(</span><span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">,</span> <span class="n" style="font-size: 12px !important;">bufsize</span><span class="p" style="font-size: 12px !important;">);</span></div><div class="line" style="font-size: 12px !important;">      <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="o" style="font-size: 12px !important;">++</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="n" style="font-size: 12px !important;">c</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">      <span class="n" style="font-size: 12px !important;">buf</span><span class="p" style="font-size: 12px !important;">[</span><span class="n" style="font-size: 12px !important;">buflen</span><span class="p" style="font-size: 12px !important;">]</span> <span class="o" style="font-size: 12px !important;">=</span> <span class="sc" style="font-size: 12px !important;">'\0'</span><span class="p" style="font-size: 12px !important;">;</span></div><div class="line" style="font-size: 12px !important;">    <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;">  <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"><span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorMoveCursor</span><span class="p" style="font-size: 12px !important;">(</span><span class="kt" style="font-size: 12px !important;">int</span> <span class="n" style="font-size: 12px !important;">key</span><span class="p" style="font-size: 12px !important;">)</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="kt" style="font-size: 12px !important;">void</span> <span class="n" style="font-size: 12px !important;">editorProcessKeypress</span><span class="p" style="font-size: 12px !important;">()</span> <span class="p" style="font-size: 12px !important;">{</span> … <span class="p" style="font-size: 12px !important;">}</span></div><div class="line" style="font-size: 12px !important;"></div><div class="line folded" style="font-size: 12px !important;"><span class="cm" style="font-size: 12px !important;">/*** init ***/</span></div></code></pre>
<div class="diff-footer" style="font-size: 16px !important;">
  <div class="diff-tag-c2" style="font-size: 16px !important;">♐︎ compiles</div>
</div>
</div>


<p style="font-size: 16px !important;">In the <a href="https://viewsourcecode.org/snaptoken/kilo/06.search.html" style="font-size: 16px !important;">next chapter</a>, we’ll make use of <code style="font-size: 12px !important;">editorPrompt()</code> to
implement an incremental search feature in our editor.</p>

    </div>
    <div id="version" style="font-size: 16px !important;">
      <a href="https://github.com/snaptoken/kilo-tutorial/tree/v1.0.0beta11" style="font-size: 16px !important;">1.0.0beta11</a>
      (<a href="https://github.com/snaptoken/kilo-tutorial/blob/master/CHANGELOG.md" style="font-size: 16px !important;">changelog</a>)
    </div>
    <footer class="bar" style="font-size: 16px !important;">
      <nav style="font-size: 16px !important;">
        <a href="#" style="font-size: 16px !important;">top of page</a>
      </nav>
    </footer>
  


<iframe src="5.%20A%20text%20editor%20Build%20Your%20Own%20Text%20Editor_files/blank_003.html" style="z-index: 2147483647; border: medium; top: 0px; left: 0px; margin: 0px; clip: auto; background-color: transparent; color-scheme: light; display: none; max-width: none !important; max-height: none !important; position: absolute !important; height: 39613px; width: 1138px;" scrolling="no" id="firefox-screenshots-selection-iframe" role="dialog"></iframe><iframe src="5.%20A%20text%20editor%20Build%20Your%20Own%20Text%20Editor_files/blank_003.html" style="z-index: 2147483647; border: medium; top: 0px; left: 0px; margin: 0px; clip: auto; background-color: transparent; color-scheme: light; position: fixed !important; width: 100%; height: 100%; max-width: none !important; max-height: none !important; display: none;" scrolling="no" id="firefox-screenshots-preselection-iframe" role="dialog"></iframe><iframe src="5.%20A%20text%20editor%20Build%20Your%20Own%20Text%20Editor_files/blank_003.html" style="z-index: 2147483647; border: medium; top: 0px; left: 0px; margin: 0px; clip: auto; background-color: transparent; color-scheme: light; display: none; position: fixed !important; height: 100%; width: 100%; max-width: none !important; max-height: none !important;" scrolling="no" id="firefox-screenshots-preview-iframe" role="dialog"></iframe></body><grammarly-desktop-integration data-grammarly-shadow-root="true"></grammarly-desktop-integration></html>